# Default values for rosa-regional-frontend

# Namespace to deploy into
namespace: rosa-regional-frontend

# Service Account configuration
serviceAccount:
  create: true
  name: rosa-regional-frontend-sa
  annotations: {}

# Application configuration
app:
  name: rosa-regional-frontend
  image:
    repository: quay.io/cdoan0/rosa-regional-frontend-api
    tag: latest
    pullPolicy: Always

  # Application arguments
  args:
    logLevel: info
    logFormat: json
    maestroUrl: http://maestro-http.maestro:8080
    dynamodbRegion: us-east-2
    dynamodbTable: rosa-customer-accounts
    apiPort: 8000
    healthPort: 8081
    metricsPort: 9090

  # Resources for the main app container
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Envoy sidecar configuration
envoy:
  image:
    repository: envoyproxy/envoy
    tag: v1.31-latest

  # Resources for the Envoy sidecar
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Deployment configuration
deployment:
  replicas: 2

# Service configuration
service:
  type: ClusterIP
  ports:
    http: 8080
    api: 8000
    health: 8081
    metrics: 9090

# Target Group (template + PostSync hook). When lookup.enabled, template uses lookupConfigMapValue (empty offline); PostSync hook creates/updates TGB from cluster ConfigMap.
targetGroup:
  lookup:
    enabled: true
    namespace: default
    configMapName: bootstrap-output
    key: api_target_group_arn
  arn: ""
  targetType: ip

# PostSync hook: create TargetGroupBinding from cluster ConfigMap (e.g. bootstrap-output)
postSyncHook:
  enabled: true
  # ConfigMap in the cluster that holds the Target Group ARN (not managed by this chart)
  bootstrapConfigMap:
    namespace: kube-system
    name: bootstrap-output
    key: api_target_group_arn
  image: bitnami/kubectl:latest

# Health probe configuration
probes:
  liveness:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
