openapi: 3.0.3
info:
  title: ROSA Regional Frontend API
  description: Frontend API for ROSA HCP regional cluster management
  version: 0.0.1
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: /api/v0
    description: API v0

paths:
  /management_clusters:
    post:
      summary: Create a new management cluster
      description: |
        Creates a new management cluster by registering a consumer in Maestro.
        Requires privileged access (admin AWS account).
      operationId: createManagementCluster
      tags:
        - ManagementClusters
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementClusterRequest'
      responses:
        '201':
          description: Management cluster created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementCluster'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - account not privileged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      summary: List all management clusters
      description: |
        Returns a list of all management clusters (consumers in Maestro).
        Requires privileged access (admin AWS account).
      operationId: listManagementClusters
      tags:
        - ManagementClusters
      parameters:
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of management clusters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementClusterList'
        '403':
          description: Forbidden - account not privileged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /management_clusters/{id}:
    get:
      summary: Get a management cluster by ID
      description: |
        Returns a specific management cluster by its ID.
        Requires privileged access (admin AWS account).
      operationId: getManagementCluster
      tags:
        - ManagementClusters
      parameters:
        - name: id
          in: path
          required: true
          description: Management cluster ID
          schema:
            type: string
      responses:
        '200':
          description: Management cluster details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementCluster'
        '403':
          description: Forbidden - account not privileged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Management cluster not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /resource_bundles:
    get:
      summary: List all resource bundles
      description: |
        Returns a paginated list of resource bundles.
        Supports filtering via search query and custom field selection.
      operationId: listResourceBundles
      tags:
        - ResourceBundles
      parameters:
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 0
            default: 100
        - name: search
          in: query
          description: SQL-like filter criteria on resource attributes
          schema:
            type: string
        - name: orderBy
          in: query
          description: SQL-like ordering (e.g., "name asc")
          schema:
            type: string
        - name: fields
          in: query
          description: Comma-separated list of fields to return
          schema:
            type: string
        - name: X-Operation-ID
          in: header
          description: Optional operation ID for tracking
          schema:
            type: string
      responses:
        '200':
          description: List of resource bundles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceBundleList'
        '401':
          description: Invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - user lacks required permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /work:
    post:
      summary: Create manifestwork for a cluster
      description: |
        Creates manifestwork for the specified cluster identified by cluster_id.
        This endpoint creates the necessary work manifest for the target cluster.
      operationId: createWork
      tags:
        - Work
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkRequest'
      responses:
        '201':
          description: Manifestwork created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Work'
        '400':
          description: Bad request - invalid cluster_id or payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - user lacks required permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Cluster not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '502':
          description: Bad Gateway - Maestro error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /live:
    get:
      summary: Liveness probe
      description: Returns 200 if the service is alive
      operationId: liveness
      tags:
        - Health
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /ready:
    get:
      summary: Readiness probe
      description: Returns 200 if the service is ready to accept traffic
      operationId: readiness
      tags:
        - Health
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Service is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  # Authorization - Account Management
  /accounts/{accountId}/enable:
    post:
      summary: Enable account for authorization
      description: |
        Enables an AWS account for Cedar/AVP-based authorization.
        Creates a policy store in Amazon Verified Permissions.
        Requires privileged access.
      operationId: enableAccount
      tags:
        - Authorization
      parameters:
        - name: accountId
          in: path
          required: true
          description: AWS account ID to enable
          schema:
            type: string
            pattern: '^\d{12}$'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnableAccountRequest'
      responses:
        '201':
          description: Account enabled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - caller is not privileged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Account already enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /accounts/{accountId}/disable:
    post:
      summary: Disable account authorization
      description: |
        Disables an AWS account from authorization.
        Deletes the policy store and all associated policies, groups, and attachments.
        Requires privileged access.
      operationId: disableAccount
      tags:
        - Authorization
      parameters:
        - name: accountId
          in: path
          required: true
          description: AWS account ID to disable
          schema:
            type: string
            pattern: '^\d{12}$'
      responses:
        '204':
          description: Account disabled successfully
        '403':
          description: Forbidden - caller is not privileged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Account not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Authorization - Policy Management
  /authz/policies:
    post:
      summary: Create a policy
      description: |
        Creates a new policy template. Policies define permissions using an IAM-like
        format with statements containing effects, actions, resources, and conditions.
        Policies must be attached to users or groups to take effect.
      operationId: createPolicy
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePolicyRequest'
      responses:
        '201':
          description: Policy created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
        '400':
          description: Bad request - invalid policy format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - account not provisioned or caller not admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      summary: List policies
      description: Returns a list of all policies for the account.
      operationId: listPolicies
      tags:
        - Authorization
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyList'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /authz/policies/{id}:
    get:
      summary: Get a policy
      description: Returns a specific policy by ID.
      operationId: getPolicy
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Policy ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Policy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Update a policy
      description: |
        Updates an existing policy. All attachments using this policy will be
        updated with the new policy content.
      operationId: updatePolicy
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Policy ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePolicyRequest'
      responses:
        '200':
          description: Policy updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
        '400':
          description: Bad request - invalid policy format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Policy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete a policy
      description: |
        Deletes a policy. All attachments using this policy will also be deleted.
      operationId: deletePolicy
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Policy ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Policy deleted successfully
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Policy not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Authorization - Group Management
  /authz/groups:
    post:
      summary: Create a group
      description: Creates a new group that can contain multiple users.
      operationId: createGroup
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
      responses:
        '201':
          description: Group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Group with this name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      summary: List groups
      description: Returns a list of all groups for the account.
      operationId: listGroups
      tags:
        - Authorization
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of groups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupList'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /authz/groups/{id}:
    get:
      summary: Get a group
      description: Returns a specific group by ID.
      operationId: getGroup
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Group ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete a group
      description: |
        Deletes a group and all its member associations.
        Attachments to this group will also be deleted.
      operationId: deleteGroup
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Group ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Group deleted successfully
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /authz/groups/{id}/members:
    get:
      summary: List group members
      description: Returns a list of all members in a group.
      operationId: listGroupMembers
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Group ID
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of group members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMemberList'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update group members
      description: Add or remove members from a group.
      operationId: updateGroupMembers
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Group ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGroupMembersRequest'
      responses:
        '200':
          description: Group members updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Authorization - Attachment Management
  /authz/attachments:
    post:
      summary: Create an attachment
      description: |
        Attaches a policy to a user or group. The policy will be translated
        to Cedar format and created in Amazon Verified Permissions.
      operationId: createAttachment
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAttachmentRequest'
      responses:
        '201':
          description: Attachment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Attachment'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Policy or target not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Attachment already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      summary: List attachments
      description: |
        Returns a list of attachments. Can be filtered by policy, target type,
        or target ID.
      operationId: listAttachments
      tags:
        - Authorization
      parameters:
        - name: policyId
          in: query
          description: Filter by policy ID
          schema:
            type: string
            format: uuid
        - name: targetType
          in: query
          description: Filter by target type (user or group)
          schema:
            type: string
            enum: [user, group]
        - name: targetId
          in: query
          description: Filter by target ID (ARN for user, groupId for group)
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of attachments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentList'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /authz/attachments/{id}:
    delete:
      summary: Delete an attachment
      description: |
        Detaches a policy from a user or group. The Cedar policy in
        Amazon Verified Permissions will be deleted.
      operationId: deleteAttachment
      tags:
        - Authorization
      parameters:
        - name: id
          in: path
          required: true
          description: Attachment ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Attachment deleted successfully
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Attachment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Authorization - Admin Management
  /authz/admins:
    post:
      summary: Add an admin
      description: |
        Adds a principal as an admin for the account. Admins bypass
        Cedar policy evaluation and have full access.
      operationId: addAdmin
      tags:
        - Authorization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAdminRequest'
      responses:
        '201':
          description: Admin added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Admin'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - caller is not an admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Admin already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      summary: List admins
      description: Returns a list of all admins for the account.
      operationId: listAdmins
      tags:
        - Authorization
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: size
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 100
      responses:
        '200':
          description: List of admins
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminList'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /authz/admins/{arn}:
    delete:
      summary: Remove an admin
      description: Removes a principal from the admin list.
      operationId: removeAdmin
      tags:
        - Authorization
      parameters:
        - name: arn
          in: path
          required: true
          description: Admin's ARN (URL-encoded)
          schema:
            type: string
      responses:
        '204':
          description: Admin removed successfully
        '403':
          description: Forbidden - caller is not an admin
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Admin not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    ManagementClusterRequest:
      type: object
      description: Request body for creating a management cluster
      properties:
        name:
          type: string
          description: |
            Optional name for the management cluster.
            Must follow RFC 1123 format (like Kubernetes namespace).
            If not provided, defaults to the generated ID.
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
          maxLength: 63
        labels:
          type: object
          description: Key-value labels for the management cluster
          additionalProperties:
            type: string

    ManagementCluster:
      type: object
      description: A management cluster (passthrough from Maestro consumer)
      required:
        - id
        - kind
        - href
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the management cluster
        kind:
          type: string
          description: Resource kind
          example: Consumer
        href:
          type: string
          description: API href reference
        name:
          type: string
          description: Unique name of the management cluster
        labels:
          type: object
          description: Key-value labels
          additionalProperties:
            type: string
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    ManagementClusterList:
      type: object
      description: Paginated list of management clusters
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          description: Resource kind
          example: ConsumerList
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        total:
          type: integer
          description: Total number of items
        items:
          type: array
          items:
            $ref: '#/components/schemas/ManagementCluster'

    ResourceBundle:
      type: object
      description: A resource bundle containing manifests for deployment
      required:
        - id
        - kind
        - href
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the resource bundle
        kind:
          type: string
          description: Resource kind
          example: ResourceBundle
        href:
          type: string
          description: API href reference
        name:
          type: string
          description: Name of the resource bundle
        consumer_name:
          type: string
          description: Name of the consumer this bundle is associated with
        version:
          type: integer
          description: Version number of the resource bundle
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        deleted_at:
          type: string
          format: date-time
          description: Deletion timestamp (if soft-deleted)
        metadata:
          type: object
          description: Additional metadata
          additionalProperties:
            type: string
        manifests:
          type: array
          description: Array of Kubernetes manifests
          items:
            type: object
        delete_option:
          type: object
          description: Deletion strategy for the resource bundle
        manifest_configs:
          type: array
          description: Configuration for manifests
          items:
            type: object
        status:
          type: object
          description: Status of the resource bundle

    ResourceBundleList:
      type: object
      description: Paginated list of resource bundles
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          description: Resource kind
          example: ResourceBundleList
        page:
          type: integer
          description: Current page number
        size:
          type: integer
          description: Number of items per page
        total:
          type: integer
          description: Total number of items
        items:
          type: array
          items:
            $ref: '#/components/schemas/ResourceBundle'

    WorkRequest:
      type: object
      description: Request body for creating manifestwork
      required:
        - cluster_id
        - data
      properties:
        cluster_id:
          type: string
          description: Unique identifier of the target cluster
        data:
          type: object
          description: |
            Payload data to be passed to Maestro gRPC for creating the manifestwork.
            This should contain the ManifestWork specification including manifests.
          additionalProperties: true

    Work:
      type: object
      description: A manifestwork resource created for a cluster
      required:
        - id
        - kind
        - href
        - cluster_id
        - name
      properties:
        id:
          type: string
          description: Unique identifier for the manifestwork
        kind:
          type: string
          description: Resource kind
          example: ManifestWork
        href:
          type: string
          description: API href reference
        cluster_id:
          type: string
          description: Cluster ID this work is associated with
        name:
          type: string
          description: Name of the manifestwork resource
          example: rosa-work-cluster-123
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        status:
          type: object
          description: Status of the manifestwork

    Error:
      type: object
      description: Error response
      required:
        - code
        - reason
      properties:
        id:
          type: string
          description: Error ID
        kind:
          type: string
          description: Resource kind
          example: Error
        href:
          type: string
          description: API href reference
        code:
          type: string
          description: Error code
        reason:
          type: string
          description: Human-readable error message
        operation_id:
          type: string
          description: Request operation ID for tracing

    HealthStatus:
      type: object
      description: Health check response
      properties:
        status:
          type: string
          enum: [ok, degraded, unavailable]
          description: Health status

    # Authorization Schemas
    EnableAccountRequest:
      type: object
      description: Request body for enabling an account
      properties:
        privileged:
          type: boolean
          description: If true, account bypasses all authorization checks
          default: false

    Account:
      type: object
      description: An enabled account
      required:
        - accountId
        - privileged
        - createdAt
      properties:
        accountId:
          type: string
          description: AWS account ID
          pattern: '^\d{12}$'
        policyStoreId:
          type: string
          description: AVP policy store ID (null if privileged)
        privileged:
          type: boolean
          description: If true, bypasses all authorization
        createdAt:
          type: string
          format: date-time
          description: When the account was enabled
        createdBy:
          type: string
          description: ARN of who enabled the account

    CreatePolicyRequest:
      type: object
      description: Request body for creating a policy
      required:
        - name
        - policy
      properties:
        name:
          type: string
          description: Policy name
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Optional policy description
          maxLength: 1024
        policy:
          $ref: '#/components/schemas/V0Policy'

    UpdatePolicyRequest:
      type: object
      description: Request body for updating a policy
      properties:
        name:
          type: string
          description: Policy name
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Optional policy description
          maxLength: 1024
        policy:
          $ref: '#/components/schemas/V0Policy'

    V0Policy:
      type: object
      description: IAM-like policy in v0 format
      required:
        - version
        - statements
      properties:
        version:
          type: string
          description: Policy format version
          enum: [v0]
        statements:
          type: array
          description: List of policy statements
          minItems: 1
          items:
            $ref: '#/components/schemas/PolicyStatement'

    PolicyStatement:
      type: object
      description: A single statement in a policy
      required:
        - effect
        - actions
        - resources
      properties:
        sid:
          type: string
          description: Optional statement ID
        effect:
          type: string
          description: Allow or Deny
          enum: [Allow, Deny]
        actions:
          type: array
          description: List of actions (e.g., rosa:CreateCluster)
          items:
            type: string
        resources:
          type: array
          description: List of resources (* for all)
          items:
            type: string
        conditions:
          type: object
          description: Optional conditions (operator -> key -> value)
          additionalProperties:
            $ref: '#/components/schemas/PolicyCondition'

    PolicyCondition:
      type: object
      description: Condition key-value pairs
      additionalProperties:
        oneOf:
          - type: string
          - type: boolean
          - type: number
          - type: array
            items:
              type: string

    Policy:
      type: object
      description: A policy template
      required:
        - id
        - kind
        - href
        - name
        - policy
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Policy ID
        kind:
          type: string
          description: Resource kind
          example: Policy
        href:
          type: string
          description: API href reference
        name:
          type: string
          description: Policy name
        description:
          type: string
          description: Policy description
        policy:
          $ref: '#/components/schemas/V0Policy'
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    PolicyList:
      type: object
      description: Paginated list of policies
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          example: PolicyList
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/Policy'

    CreateGroupRequest:
      type: object
      description: Request body for creating a group
      required:
        - name
      properties:
        name:
          type: string
          description: Group name
          minLength: 1
          maxLength: 255
        description:
          type: string
          description: Optional group description
          maxLength: 1024

    Group:
      type: object
      description: A group of users
      required:
        - id
        - kind
        - href
        - name
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Group ID
        kind:
          type: string
          example: Group
        href:
          type: string
          description: API href reference
        name:
          type: string
          description: Group name
        description:
          type: string
          description: Group description
        memberCount:
          type: integer
          description: Number of members in the group
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp

    GroupList:
      type: object
      description: Paginated list of groups
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          example: GroupList
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/Group'

    GroupMember:
      type: object
      description: A member of a group
      required:
        - memberArn
        - addedAt
      properties:
        memberArn:
          type: string
          description: Member's AWS ARN
        addedAt:
          type: string
          format: date-time
          description: When the member was added

    GroupMemberList:
      type: object
      description: Paginated list of group members
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          example: GroupMemberList
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/GroupMember'

    UpdateGroupMembersRequest:
      type: object
      description: Request body for updating group members
      properties:
        add:
          type: array
          description: ARNs to add to the group
          items:
            type: string
        remove:
          type: array
          description: ARNs to remove from the group
          items:
            type: string

    CreateAttachmentRequest:
      type: object
      description: Request body for creating an attachment
      required:
        - policyId
        - targetType
        - targetId
      properties:
        policyId:
          type: string
          format: uuid
          description: Policy ID to attach
        targetType:
          type: string
          description: Type of target (user or group)
          enum: [user, group]
        targetId:
          type: string
          description: Target ID (ARN for user, groupId for group)

    Attachment:
      type: object
      description: A policy attachment to a user or group
      required:
        - id
        - kind
        - href
        - policyId
        - targetType
        - targetId
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Attachment ID
        kind:
          type: string
          example: Attachment
        href:
          type: string
          description: API href reference
        policyId:
          type: string
          format: uuid
          description: Attached policy ID
        policyName:
          type: string
          description: Attached policy name
        targetType:
          type: string
          description: Target type
          enum: [user, group]
        targetId:
          type: string
          description: Target ID
        avpPolicyId:
          type: string
          description: Policy ID in Amazon Verified Permissions
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp

    AttachmentList:
      type: object
      description: Paginated list of attachments
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          example: AttachmentList
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'

    AddAdminRequest:
      type: object
      description: Request body for adding an admin
      required:
        - principalArn
      properties:
        principalArn:
          type: string
          description: ARN of the principal to make admin

    Admin:
      type: object
      description: An admin for the account
      required:
        - principalArn
        - createdAt
      properties:
        principalArn:
          type: string
          description: Admin's AWS ARN
        createdAt:
          type: string
          format: date-time
          description: When the admin was added
        createdBy:
          type: string
          description: ARN of who added this admin

    AdminList:
      type: object
      description: Paginated list of admins
      required:
        - kind
        - page
        - size
        - total
        - items
      properties:
        kind:
          type: string
          example: AdminList
        page:
          type: integer
        size:
          type: integer
        total:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/Admin'
