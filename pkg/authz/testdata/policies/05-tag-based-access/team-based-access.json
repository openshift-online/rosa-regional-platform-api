{
  "id": "abac-003",
  "name": "Team-based cluster access using principal tags",
  "description": "Policy that allows access to clusters based on matching team tags between the principal and the resource.",
  "policyFile": "team-based-access.cedar",
  "testCases": [
    {
      "description": "Platform team member can update platform team cluster",
      "principal": {
        "tags": {
          "Team": "platform"
        }
      },
      "request": {
        "action": "UpdateClusterConfig",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/platform-services",
        "resourceTags": {
          "Team": "platform"
        },
        "context": {
          "principalTags": {
            "Team": "platform"
          }
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Platform team member cannot update application team cluster",
      "principal": {
        "tags": {
          "Team": "platform"
        }
      },
      "request": {
        "action": "UpdateClusterConfig",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/app-services",
        "resourceTags": {
          "Team": "applications"
        },
        "context": {
          "principalTags": {
            "Team": "platform"
          }
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Application team member can create node pool on their cluster",
      "principal": {
        "tags": {
          "Team": "applications"
        }
      },
      "request": {
        "action": "CreateNodePool",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/app-services",
        "resourceTags": {
          "Team": "applications"
        },
        "context": {
          "principalTags": {
            "Team": "applications"
          }
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Any team member can list all clusters",
      "principal": {
        "tags": {
          "Team": "platform"
        }
      },
      "request": {
        "action": "ListClusters",
        "resource": "*"
      },
      "expectedResult": "ALLOW"
    }
  ],
  "notes": "Uses principal tags on IAM users/roles matched against resource tags. Scales well with multiple teams without policy changes."
}
