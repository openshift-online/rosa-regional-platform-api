{
  "id": "deny-003",
  "name": "Deny modifications to protected tags",
  "description": "Policy that denies adding, changing, or removing specific protected tags (like Environment or Owner). Prevents circumventing tag-based access controls.",
  "policyFile": "deny-tag-modifications.cedar",
  "testCases": [
    {
      "description": "Cannot remove Environment tag",
      "request": {
        "action": "UntagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "tagKeys": [
            "Environment"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Cannot change Owner tag",
      "request": {
        "action": "TagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "tagKeys": [
            "Owner"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Can add non-protected tags",
      "additionalPolicies": [
        "permit(\n  ?principal,\n  action,\n  resource\n);"
      ],
      "request": {
        "action": "TagResource",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "tagKeys": [
            "Description",
            "Team"
          ]
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Cannot create cluster without Environment tag",
      "request": {
        "action": "CreateCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/new-cluster",
        "context": {
          "requestTags": {
            "Name": "my-cluster"
          }
        }
      },
      "expectedResult": "DENY"
    }
  ],
  "notes": "This is crucial for ABAC security. If users can modify tags, they can bypass tag-based access controls. Combine with required tag enforcement."
}
