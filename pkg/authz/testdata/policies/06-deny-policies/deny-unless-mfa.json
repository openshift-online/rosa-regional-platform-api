{
  "id": "deny-004",
  "name": "Deny destructive actions without MFA",
  "description": "Policy that denies destructive ROSA operations unless the user has authenticated with MFA.",
  "policyFile": "deny-unless-mfa.cedar",
  "testCases": [
    {
      "description": "Cannot delete cluster without MFA",
      "request": {
        "action": "DeleteCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "mfaPresent": "false"
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Can delete cluster with MFA",
      "additionalPolicies": [
        "permit(\n  ?principal,\n  action,\n  resource\n);"
      ],
      "request": {
        "action": "DeleteCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "mfaPresent": "true"
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Can describe cluster without MFA (non-destructive)",
      "additionalPolicies": [
        "permit(\n  ?principal,\n  action,\n  resource\n);"
      ],
      "request": {
        "action": "DescribeCluster",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "mfaPresent": "false"
        }
      },
      "expectedResult": "ALLOW"
    }
  ],
  "notes": "Adds an extra layer of security for destructive operations. Users must re-authenticate with MFA to perform deletions."
}
