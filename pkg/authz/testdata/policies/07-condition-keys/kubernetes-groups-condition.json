{
  "id": "condition-001",
  "name": "Restrict access entry Kubernetes groups",
  "description": "Policy that restricts which Kubernetes groups can be assigned when creating access entries. Prevents granting system:masters or other privileged groups.",
  "policyFile": "kubernetes-groups-condition.cedar",
  "testCases": [
    {
      "description": "Cannot create access entry with system:masters group",
      "request": {
        "action": "CreateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "kubernetesGroups": [
            "system:masters"
          ]
        }
      },
      "expectedResult": "DENY"
    },
    {
      "description": "Can create access entry with system:nodes group (no wildcard deny in Cedar)",
      "request": {
        "action": "CreateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "kubernetesGroups": [
            "system:nodes"
          ]
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Can create access entry with custom group",
      "request": {
        "action": "CreateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:cluster/my-cluster",
        "context": {
          "kubernetesGroups": [
            "developers",
            "viewers"
          ]
        }
      },
      "expectedResult": "ALLOW"
    }
  ],
  "notes": "Prevents privilege escalation through access entries. Users cannot grant themselves or others system:masters access even if they can create access entries. Note: The V0 policy used ForAnyValue:StringLike with system:* wildcard to deny all system-prefixed groups. Cedar does not support wildcard matching on set elements, so only system:masters is explicitly denied. Add additional forbid statements for other specific system groups as needed."
}
