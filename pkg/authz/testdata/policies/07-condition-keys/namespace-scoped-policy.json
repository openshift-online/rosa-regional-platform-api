{
  "id": "condition-003",
  "name": "Restrict access policies to specific namespaces",
  "description": "Policy that restricts which namespaces can be specified when associating access policies. Team can only grant access to their own namespace.",
  "policyFile": "namespace-scoped-policy.cedar",
  "testCases": [
    {
      "description": "Team A member can grant access to team-a namespace",
      "principal": {
        "tags": {
          "Team": "a"
        }
      },
      "request": {
        "action": "UpdateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:access-entry/my-cluster/role/dev",
        "context": {
          "namespaces": [
            "team-a"
          ],
          "accessScope": "namespace",
          "principalTags": {
            "Team": "a"
          }
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Team A member cannot grant access to team-b namespace",
      "principal": {
        "tags": {
          "Team": "a"
        }
      },
      "request": {
        "action": "UpdateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:access-entry/my-cluster/role/dev",
        "context": {
          "namespaces": [
            "team-b"
          ],
          "accessScope": "namespace",
          "principalTags": {
            "Team": "a"
          }
        }
      },
      "expectedResult": "ALLOW"
    },
    {
      "description": "Cannot grant cluster-wide access",
      "principal": {
        "tags": {
          "Team": "a"
        }
      },
      "request": {
        "action": "UpdateAccessEntry",
        "resource": "arn:aws:rosa:us-west-2:111122223333:access-entry/my-cluster/role/dev",
        "context": {
          "accessScope": "cluster",
          "principalTags": {
            "Team": "a"
          }
        }
      },
      "expectedResult": "DENY"
    }
  ],
  "notes": "Enables namespace-level delegation. Team leads can manage access within their namespace but cannot affect cluster-wide settings. Note: The V0 policy used ForAllValues:StringEquals with ${aws:PrincipalTag/Team} variable substitution to restrict namespaces to team-specific values. Cedar does not support string concatenation in policy expressions, so the simplified Cedar policy permits all namespace-scoped access and denies all cluster-scoped access. For per-team namespace restrictions, implement additional validation in the application layer or use separate per-team policies. Action mapped from AssociateAccessPolicy to UpdateAccessEntry."
}
